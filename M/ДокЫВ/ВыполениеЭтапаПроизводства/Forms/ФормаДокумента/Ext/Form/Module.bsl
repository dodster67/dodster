&НаСервере
Процедура ДобавитьЗаписьНаСервере()
    
    // СОЗДАЕМ СТРУКТУРУ ДЛЯ ОТПРАВКИ (НЕ МАССИВ!)
    ДанныеДляОтправки = Новый Структура;
	
	// Заполняем шапку документа
	ДанныеДляОтправки.Вставить("Дата", Строка(Объект.Дата));
	ДанныеДляОтправки.Вставить("Проведен", Строка(Объект.Проведен));
	ДанныеДляОтправки.Вставить("Заказ", Объект.Заказ.Номер); // Только номер
	ДанныеДляОтправки.Вставить("Номенклатура", Строка(Объект.Номенклатура));
	ДанныеДляОтправки.Вставить("Склад", Строка(Объект.Склад));
	ДанныеДляОтправки.Вставить("Количество", Строка(Объект.Количество));
	ДанныеДляОтправки.Вставить("Статус", Строка(Объект.Статус));
    
    // ========== ЗАТРАЧЕННЫЕ МАТЕРИАЛЫ ==========
    // Создаем массив для табличной части
    МассивМатериалов = Новый Массив;
    
    // Обходим строки табличной части
    Для Каждого СтрокаТЧ Из Объект.ЗатраченныеМатериалы Цикл
        
        // Создаем структуру для одной строки
        Материал = Новый Структура;
        
        // Вставляем поля по одному, а не через ЗаполнитьЗначенияСвойств
        Материал.Вставить("Склад", Строка(СтрокаТЧ.Склад));
        Материал.Вставить("Материал", Строка(СтрокаТЧ.ЗатраченныеМатериалы));
        Материал.Вставить("ЕдиницаИзмерения", Строка(СтрокаТЧ.ЕдиницаИзмерения));
        Материал.Вставить("Количество", Строка(СтрокаТЧ.Количество));
        
        // Добавляем в массив
        МассивМатериалов.Добавить(Материал);
    КонецЦикла;
    
    // Добавляем массив в структуру отправки
    ДанныеДляОтправки.Вставить("ЗатраченныеМатериалы", МассивМатериалов);
    
    // ========== ТРУДОЗАТРАТЫ ==========
    // Создаем массив для табличной части
    МассивТрудозатрат = Новый Массив;
    
    // Обходим строки табличной части
    Для Каждого СтрокаТЧ Из Объект.Трудозатраты Цикл
        
        // Создаем структуру для одной строки
        Трудозатрата = Новый Структура;
        
        // Вставляем поля по одному
        Трудозатрата.Вставить("ВидРаботы", Строка(СтрокаТЧ.ВидРаботы));
        Трудозатрата.Вставить("Время", Строка(СтрокаТЧ.Время));
        Трудозатрата.Вставить("Бригада", Строка(СтрокаТЧ.Бригада));
        
        // Добавляем в массив
        МассивТрудозатрат.Добавить(Трудозатрата);
    КонецЦикла;
    
    // Добавляем массив в структуру отправки
    ДанныеДляОтправки.Вставить("Трудозатраты", МассивТрудозатрат);
    
    // ========== ПРЕОБРАЗУЕМ В JSON ==========
    // Записываем структуру в JSON (НЕ МАССИВ!)
    JSON = ЗаписатьЗначениеJSON(ДанныеДляОтправки);
    
    // Для отладки - посмотрим что отправляем    
    // ========== ОТПРАВКА НА СЕРВЕР ==========
	Попытка
		АдресСервера = "192.168.0.150:8080";
		СтрокаЗапроса = "/WEB/hs/services/uta";

        Соединение = Новый HTTPСоединение(АдресСервера);
        ЗапросHTTP = Новый HTTPЗапрос(СтрокаЗапроса);
        // Тело запроса
        ЗапросHTTP.УстановитьТелоИзСтроки(JSON);
        
        // Отправляем
        Ответ = Соединение.Записать(ЗапросHTTP);
		
        // Проверяем ответ
        Если Ответ.КодСостояния = 200 Тогда
            Сообщить("Документ успешно отправлен на сервер!");
        Иначе
            Сообщить("Ошибка на сервере (код " + Ответ.КодСостояния + "): " + Ответ.ПолучитьТелоКакСтроку());
        КонецЕсли;
        
    Исключение
        Сообщить("Ошибка соединения: " + ОписаниеОшибки());
    КонецПопытки;
    
КонецПроцедуры

&НаКлиенте
Процедура ДобавитьЗапись(Команда)
    ДобавитьЗаписьНаСервере();
КонецПроцедуры