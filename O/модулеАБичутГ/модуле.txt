Сначала создайте Перечисления (Enum), так как на них ссылаются справочники:

Тип

Единица_измерения

Статус






Затем создайте простые справочники (ни на кого не ссылаются):

СкладМатериалов

СкладГотовойПродукции

Рабочая_бригада

Этапы

СтоимостьЧаса








Создайте справочник Номенклатура (он ссылается на перечисления Тип и Единица_измерения).

В последнюю очередь создайте самый сложный справочник Спецификации, так как он ссылается на Номенклатуру, Этапы, СтоимостьЧаса и сам на себя.

1. Перечисления (Нужно создать их первыми в ветке "Перечисления")
Тип (Тип номенклатуры)
Где создать: Перечисления -> Добавить

Имя: Тип

Синоним: Тип

Комментарий: Можно оставить пустым.

Данные: На вкладке "Данные" нужно будет добавить значения перечисления (например: "Материал", "Полуфабрикат", "Готовая продукция", "Услуга"). В XML-файле они не описаны, но подразумеваются.

Единица_измерения
Где создать: Перечисления -> Добавить

Имя: Единица_измерения

Синоним: Единица измерения

Данные: Добавьте предопределенные значения (например: "шт", "кг", "м", "час").

Статус (Статус спецификации)
Где создать: Перечисления -> Добавить

Имя: Статус

Синоним: Статус

Данные: Добавьте значения (например: "В разработке", "Утвержден", "Закрыт").

Как создать форму элемента для справочника "Номенклатура" (по образу Form.xml):

В окне редактирования справочника Номенклатура перейдите на вкладку Формы.

Нажмите лупу у поля Форма элемента и выберите "Добавить" или нажмите на зеленый плюс. Откроется конструктор форм.

Тип формы: Оставьте Форма элемента.

Имя: Задайте ФормаЭлемента1 (как в файле).

Синоним: Форма элемента1.

Нажмите Готово.

Теперь нужно отредактировать созданную форму, чтобы она соответствовала присланному файлу:

События формы (вкладка "Свойства" формы, "События"):

ПриСозданииНаСервере — укажите имя процедуры-обработчика ПриСозданииНаСервере (можно создать позже).

ПослеЗаписиНаСервере — укажите ПослеЗаписиНаСервере.

Реквизиты формы (вкладка "Реквизиты"):

У вас уже есть главный реквизит Объект. Это ссылка на сам справочник.

Добавьте сверху, нажав "Добавить", следующие реквизиты (это вспомогательные поля для загрузки картинки):

АдресКартинкиВХ — Тип: Строка (произвольной длины).

РазмерФайла — Тип: Число (длина: 10, точность: 2).

РасширениеФайла — Тип: Строка (произвольной длины).

Элементы формы (вкладка "Элементы"):

Сделайте видимыми поля Код, Наименование, Тип, Единица_измерения, перетащив их из панели "Реквизиты" (или они будут там по умолчанию).

Создайте структуру по образцу из файла:

Добавьте элемент формы типа Страницы (это будет закладки). Назовите его ГруппаСтраницы.

Внутри него создайте две Группа - Страница:

Первая: ГруппаОсновное с заголовком "Основное". Перенесите в нее поля Код, Наименование, Тип, Единица_измерения.

Вторая: ГруппаКартинка с заголовком "Картинка".

Внутрь этой страницы добавьте элемент типа ПолеКартинки, назовите его АдресКартинкиВХ.

В свойстве ПутьКДанным этого поля укажите АдресКартинкиВХ (наш вспомогательный реквизит).

На вкладке "События" для этого поля найдите событие Нажатие и укажите обработчик АдресКартинкиВХНажатие.

Это полностью воссоздаст структуру формы, готовую для написания кода по загрузке картинки в реквизит Картинка справочника.










2. Справочники


СкладМатериалов
Где создать: Справочники -> Добавить

Имя: СкладМатериалов

Синоним: Склад материалов

Длина наименования: 50 (на вкладке "Данные").

Основное представление: В виде наименования (на вкладке "Формы").

Реквизиты: Нет собственных реквизитов, только стандартные "Код" и "Наименование" (которое в XML называется Description).




СкладГотовойПродукции
Где создать: Справочники -> Добавить

Имя: СкладГотовойПродукции

Синоним: Склад готовой продукции

Длина наименования: 50.

Основное представление: В виде наименования.

Реквизиты: Нет собственных реквизитов.






Этапы
Где создать: Справочники -> Добавить

Имя: Этапы

Синоним: Этапы

Представление объекта: Этап (на вкладке "Прочее").

Длина наименования: 50.

Длина кода: 0 (Код не используется, тип Строка). Отключите автонумерацию.

Основное представление: В виде наименования.

Реквизиты: Нет собственных реквизитов.






СтоимостьЧаса
Где создать: Справочники -> Добавить

Имя: СтоимостьЧаса

Синоним: Стоимость часа

Длина наименования: 100.

Длина кода: 0 (Код не используется, тип Строка). Отключите автонумерацию.

Основное представление: В виде наименования.

Реквизиты (на вкладке "Данные"):

Добавить -> СтоимостьЧаса

Тип: Число (длина 10, точность 2)

Синоним: Стоимость часа








Рабочая_бригада
Где создать: Справочники -> Добавить

Имя: Рабочая_бригада

Синоним: Рабочая бригада

Длина наименования: 25.

Иерархический: Да. Тип иерархии: Иерархия групп и элементов. Папки сверху: Да.

Реквизиты: Нет собственных реквизитов.








3. Справочник "Номенклатура"
Где создать: Справочники -> Добавить

Имя: Номенклатура

Синоним: Номенклатура

Длина наименования: 100. Синоним реквизита "Наименование" задайте как "Название товара" (на вкладке "Данные" у стандартного реквизита "Наименование").

Длина кода: 9. Синоним реквизита "Код" задайте как "Артикул".

Основное представление: В виде наименования.

Реквизиты (на вкладке "Данные"):

Добавить -> Тип
Тип: ПеречислениеСсылка.Тип
Синоним: Тип
Добавить -> Единица_измерения
Тип: ПеречислениеСсылка.Единица_измерения
Синоним: Единица измерения
Добавить -> Картинка
Тип: ХранилищеЗначения (позволяет хранить картинку)
Синоним: Картинка










4. Справочник "Спецификации" (Самый сложный)
Где создать: Справочники -> Добавить

Имя: Спецификации

Синоним: Спецификации

Длина наименования: 0 (не используется).

Длина кода: 9. Тип кода: Строка. Автонумерация: Да.

Основное представление: В виде кода.

Реквизиты (на вкладке "Данные"):

Добавить -> Выходное_изделие
Тип: СправочникСсылка.Номенклатура
Синоним: Выходное изделие
Добавить -> Количество
Тип: Число (длина 10, точность 0)
Синоним: Количество
Добавить -> Единица_измерения
Тип: ПеречислениеСсылка.Единица_измерения
Синоним: Единица измерения
Добавить -> Статус
Тип: ПеречислениеСсылка.Статус
Синоним: Статус
Табличные части (на вкладке "Данные"):

1. Табличная часть "Материалы"

Имя: Материалы

Синоним: Материалы

Реквизиты ТЧ:

Добавить -> Материал
Тип: СправочникСсылка.Номенклатура
Добавить -> Количество
Тип: Число (10, 0)
Добавить -> Единица_Измерения
Тип: ПеречислениеСсылка.Единица_измерения
Добавить -> Этап
Тип: СправочникСсылка.Этапы
Добавить -> Спецификация
Тип: СправочникСсылка.Спецификации (ссылка на эту же спецификацию, для вложенности)
2. Табличная часть "ТрудозатратыПоЭтапам"

Имя: ТрудозатратыПоЭтапам

Синоним: Трудозатраты по этапам

Реквизиты ТЧ:

Добавить -> ВидРабот
Тип: СправочникСсылка.СтоимостьЧаса
Примечание: название реквизита в XML — ВидРабот, но тип ссылается на справочник стоимости часа (т.е. Вид работ определяется стоимостью часа).
Добавить -> ТребуемоеВремяВыполнения
Тип: Число (10, 0)
Синоним: Требуемое время выполнения (минут)











Документ "ВыполнениеЭтапаПроизводства"
Где создать: Документы -> Добавить

Имя: ВыполениеЭтапаПроизводства (строго как в файле, с одной "л")

Синоним: Выполение этапа производства

На вкладке "Данные":

Нумерация:

Тип номера: Строка

Длина номера: 9

Периодичность: Непериодический

Автонумерация: Да

Контроль уникальности: Да

Реквизиты (шапка документа):

Добавить -> Заказ

Тип: ДокументСсылка.Заказ

Синоним: Заказ

Добавить -> Номенклатура (что производим)

Тип: СправочникСсылка.Номенклатура

Синоним: Номенклатура

Важно: В XML для этого поля есть параметры выбора ChoiceParameters. Чтобы их воссоздать, нужно нажать на кнопку "..." у поля Связи параметров выбора и в таблице добавить отбор, чтобы выбиралась только номенклатура с типом "Полуфабрикат" или "Готовая_продукция".

Добавить -> Склад

Тип: СправочникСсылка.СкладГотовойПродукции

Синоним: Склад

Добавить -> Количество

Тип: Число (длина: 10, точность: 0)

Синоним: Количество

Добавить -> Статус

Тип: ПеречислениеСсылка.СтатусЭтапаПроизводства

Синоним: Статус

Табличные части:

3.1. Табличная часть "ЗатраченныеМатериалы"

Имя: ЗатраченныеМатериалы

Синоним: Затраченные материалы

Реквизиты ТЧ:

Добавить -> Склад

Тип: СправочникСсылка.СкладМатериалов

Добавить -> ЗатраченныеМатериалы (да, реквизит называется так же, как и ТЧ)

Тип: СправочникСсылка.Номенклатура

Важно: В параметрах выбора нужно настроить отбор по типу номенклатуры "Сырье" или "Полуфабрикат".

Добавить -> ЕдиницаИзмерения

Тип: ПеречислениеСсылка.Единица_измерения

Добавить -> Количество

Тип: Число (10, 0)

3.2. Табличная часть "Трудозатраты"

Имя: Трудозатраты

Синоним: Трудозатраты

Реквизиты ТЧ:

Добавить -> ВидРаботы

Тип: СправочникСсылка.СтоимостьЧаса

Добавить -> Время

Тип: Число (10, 0)

Синоним: Время (минут)

Добавить -> Бригада

Тип: СправочникСсылка.Рабочая_бригада

На вкладке "Движения":

Здесь перечислены регистры, которые будет двигать этот документ.

Нажмите кнопку Регистры -> Регистры накопления.

В открывшемся списке отметьте галками три регистра (даже если их еще нет, галочки поставьте, они создадутся позже):

СкладГотовойПродукции

ВыпускГотовойПродукции

СкладМатериалов

На вкладке "Ввод на основании":
Можно не заполнять, либо добавить документ Заказ, так как он указан в BasedOn.















1. Создание документа "Заказ"
Где создать: Документы -> Добавить

Имя: Заказ

Синоним: Заказ

На вкладке "Данные":

Нумерация:

Тип номера: Строка

Длина номера: 9

Периодичность: Непериодический

Автонумерация: Да

Контроль уникальности: Да

Реквизиты (шапка):

У документа нет реквизитов в шапке, кроме стандартных "Номер" и "Дата". Все данные хранятся в табличной части.

Табличная часть:

Добавить -> СписокИзделий

Синоним: Список изделий

Реквизиты ТЧ:

Добавить -> Номенклатура

Тип: СправочникСсылка.Номенклатура

Добавить -> Количество

Тип: Число (длина: 10, точность: 0)

Добавить -> ЕдиницаИзмерения

Тип: ПеречислениеСсылка.Единица_измерения

Добавить -> Спецификации

Тип: СправочникСсылка.Спецификации




2. Создание формы документа (ФормаДокумента)
Теперь создадим форму для документа, как в присланных файлах Form.xml (описание формы) и ФормаДокумента.xml (метаданные формы).

В окне редактирования документа Заказ перейдите на вкладку Формы.

Нажмите лупу у поля Форма документа -> Добавить. Откроется конструктор форм.

Тип формы: Оставьте Форма документа.

Имя: Задайте ФормаДокумента (как в файле).

Синоним: Форма документа.

Нажмите Готово.

Теперь отредактируем форму:

Реквизиты формы (вкладка "Реквизиты"):

Убедитесь, что главный реквизит Объект существует и имеет тип ДокументОбъект.Заказ. Других реквизитов не нужно.

Элементы формы (вкладка "Элементы"):

Перетащите поля Номер и Дата из панели "Реквизиты" на форму. Они появятся вверху.

Добавление таблицы "СписокИзделий":

Найдите в папке Объект реквизит табличной части СписокИзделий.

Перетащите его на форму. Автоматически создастся элемент Таблица с нужными колонками.

Настройте колонки таблицы (порядок можно менять перетаскиванием):

Должны быть колонки: Номенклатура, Количество, ЕдиницаИзмерения, Спецификации.

В свойствах таблицы на вкладке "Общие" можно установить флажок Автоматически вставлять новую строку для удобства ввода.


3. Создание формы списка (ФормаСписка)
Форма списка (Form.xml и ФормаСписка.xml) более сложная: она содержит командную панель с кнопками и динамический список.

В окне редактирования документа Заказ на вкладке Формы нажмите лупу у поля Форма списка -> Добавить.

Тип формы: Выберите Форма списка.

Имя: Задайте ФормаСписка.

Синоним: Форма списка.

Нажмите Готово.

Редактирование формы списка:

Команды формы (вкладка "Команды"):

Добавьте две команды (зеленый плюс -> "Создать команду"):

ЗагрузитьДанные -> Синоним: Загрузить данные

СформироватьЭтапы -> Синоним: Сформировать этапы производства (Автоматически)

Подсказка: В XML-файле у команд есть <Action>, это значит, что позже нужно будет создать одноименные процедуры-обработчики в модуле формы.

Реквизиты формы (вкладка "Реквизиты"):

Будет автоматически создан главный реквизит Список типа ДинамическийСписок. В его свойствах нужно настроить основную таблицу:

Найдите реквизит Список, откройте его свойства.

В поле Произвольный запрос должно быть Ложь.

В поле Основная таблица выберите Документ.Заказ.

Элементы формы (вкладка "Элементы"):

Командная панель: По умолчанию уже есть командная панель (ФормаКоманднаяПанель). Добавьте на нее наши кнопки. Для этого:

Найдите в списке элементов ФормаКоманднаяПанель, раскройте ее.

Перетащите команды ЗагрузитьДанные и СформироватьЭтапы из папки "Команды" прямо внутрь ФормаКоманднаяПанель.

Таблица "Список": На форме уже есть элемент Список (таблица). В его свойствах можно настроить:

Режим обновления: Авто

Чередовать цвета строк: Да

Колонки таблицы: Раскройте элемент Список. В нем уже есть колонки Дата и Номер. Оставьте их. Других колонок в XML нет.








Создание документа "Закупка"
Где создать: Документы -> Добавить

Имя: Закупка

Синоним: Закупка

На вкладке "Данные":

Нумерация:

Тип номера: Строка

Длина номера: 9

Периодичность: Непериодический

Автонумерация: Да

Контроль уникальности: Да

Реквизиты (шапка документа):

Добавить -> Склад

Тип: СправочникСсылка.СкладМатериалов

Синоним: Склад

Табличная часть:

Добавить -> Закупка (да, ТЧ называется так же, как и документ)

Синоним: Закупка

Реквизиты ТЧ:

Добавить -> Материал

Тип: СправочникСсылка.Номенклатура

Важно: В XML для этого поля есть параметры выбора ChoiceParameters. Чтобы их воссоздать, нужно нажать на кнопку "..." у поля Связи параметров выбора и в таблице добавить отбор, чтобы выбиралась только номенклатура с типом "Сырье" или "Полуфабрикат".

Добавить -> Количество

Тип: Число (длина: 10, точность: 0)

Добавить -> Цена

Тип: Число (длина: 10, точность: 2)

Добавить -> Сумма

Тип: Число (длина: 10, точность: 2)

На вкладке "Движения":

Здесь указано, что документ будет двигать регистр "СкладМатериалов".

Нажмите кнопку Регистры -> Регистры накопления.

В открывшемся списке отметьте галкой регистр: СкладМатериалов (даже если его еще нет, галочку поставьте, он создастся позже).




2. Создание формы документа (ФормаДокумента)
Теперь создадим форму для документа, как в присланных файлах Form.xml (описание формы) и ФормаДокумента.xml (метаданные формы).

В окне редактирования документа Закупка перейдите на вкладку Формы.

Нажмите лупу у поля Форма документа -> Добавить. Откроется конструктор форм.

Тип формы: Оставьте Форма документа.

Имя: Задайте ФормаДокумента (как в файле).

Синоним: Форма документа.

Нажмите Готово.

Теперь отредактируем форму:

Реквизиты формы (вкладка "Реквизиты"):

Убедитесь, что главный реквизит Объект существует и имеет тип ДокументОбъект.Закупка. Других реквизитов не нужно.

Элементы формы (вкладка "Элементы"):

Перетащите поля Номер, Дата и Склад из панели "Реквизиты" на форму. Они появятся вверху.

Добавление таблицы "Закупка":

Найдите в папке Объект реквизит табличной части Закупка.

Перетащите его на форму. Автоматически создастся элемент Таблица с колонками.

Настройка колонок таблицы:

В таблице должны быть колонки: Материал, Количество, Цена, Сумма.

События колонок (важно!):

Выделите колонку Количество. В палитре свойств на вкладке "События" найдите событие ПриИзменении и задайте процедуру-обработчик ЗакупкаКоличествоПриИзменении.

Выделите колонку Цена. В событии ПриИзменении задайте процедуру ЗакупкаЦенаПриИзменении.

Это нужно для автоматического пересчета суммы.

Настройка итогов (подвала) таблицы:

В свойствах самой таблицы (элемент Закупка) на вкладке "Общие" установите флажок Подвал.

Выделите колонку Сумма. В палитре свойств найдите поле ПутьКДаннымПодвала и выберите Объект.Закупка.TotalСумма. Это системное поле, которое автоматически показывает итог по колонке.









Документ "Перенос"
Где создать: Документы -> Добавить

Имя: Перенос

Синоним: Перенос

На вкладке "Данные":

Нумерация:

Тип номера: Строка

Длина номера: 9

Периодичность: Непериодический

Автонумерация: Да

Контроль уникальности: Да

Реквизиты (шапка документа):

Добавить -> СкладОтправитель

Тип: СправочникСсылка.СкладМатериалов

Синоним: Склад отправитель

Добавить -> СкладПриниматель

Тип: СправочникСсылка.СкладМатериалов

Синоним: Склад приниматель

Табличная часть:

Добавить -> Перенос (ТЧ называется так же, как и документ)

Синоним: Перенос

Реквизиты ТЧ:

Добавить -> Материал

Тип: СправочникСсылка.Номенклатура

Важно: В XML для этого поля есть параметры выбора ChoiceParameters. Чтобы их воссоздать, нужно нажать на кнопку "..." у поля Связи параметров выбора и в таблице добавить отбор, чтобы выбиралась только номенклатура с типом "Сырье" или "Полуфабрикат".

Добавить -> Количество

Тип: Число (длина: 10, точность: 0)

На вкладке "Движения":

Здесь указано, что документ будет двигать регистр "СкладМатериалов".

Нажмите кнопку Регистры -> Регистры накопления.

В открывшемся списке отметьте галкой регистр: СкладМатериалов.

















1. Создание документа "РасчетСебестоимости"
Где создать: Документы -> Добавить

Имя: РасчетСебестоимости

Синоним: Расчет себестоимости

На вкладке "Данные":

Нумерация:

Тип номера: Строка

Длина номера: 9

Периодичность: Непериодический

Автонумерация: Да

Контроль уникальности: Да

Реквизиты (шапка документа):

Добавить -> Номенклатура (что выпускаем)

Тип: СправочникСсылка.Номенклатура

Синоним: Номенклатура

Табличные части:

3.1. Табличная часть "Себестоимость" (материальные затраты)

Добавить -> Себестоимость

Синоним: Себестоимость

Реквизиты ТЧ:

Добавить -> Материал

Тип: СправочникСсылка.Номенклатура

Добавить -> Количество

Тип: Число (длина: 10, точность: 0)

Добавить -> Цена

Тип: Число (длина: 10, точность: 2)

Добавить -> Сумма

Тип: Число (длина: 10, точность: 2)

3.2. Табличная часть "Труды" (трудовые затраты)

Добавить -> Труды

Синоним: Труды

Реквизиты ТЧ:

Добавить -> ВидРаботы

Тип: СправочникСсылка.СтоимостьЧаса

Добавить -> Трудозатраты

Тип: Число (длина: 10, точность: 0)

Примечание: Судя по типу данных, это количество минут или часов.

На вкладке "Движения":

Нажмите кнопку Регистры -> Регистры накопления.

В открывшемся списке отметьте галкой регистр: РасчетСебестоимости.

На вкладке "Прочее":

Подчинен: Нажмите на поле ввода и выберите документы Закупка и ВыполениеЭтапаПроизводства (можно выбрать несколько).

Проведение: Разрешить

Оперативное проведение: Разрешить

Удаление движений: Автоматически удалять при отмене проведения

Режим блокировки данных: Управляемый

2. Создание формы документа (ФормаДокумента)
Теперь создадим форму для документа, как в присланных файлах Form.xml (описание формы) и ФормаДокумента.xml (метаданные формы).

В окне редактирования документа РасчетСебестоимости перейдите на вкладку Формы.

Нажмите лупу у поля Форма документа -> Добавить.

Тип формы: Оставьте Форма документа.

Имя: Задайте ФормаДокумента.

Синоним: Форма документа.

Нажмите Готово.

Редактирование формы:

Реквизиты формы (вкладка "Реквизиты"):

Убедитесь, что главный реквизит Объект существует и имеет тип ДокументОбъект.РасчетСебестоимости.

Элементы формы (вкладка "Элементы"):

Перетащите поля Номер, Дата и Номенклатура из панели "Реквизиты" на форму.

Настройка поля "Номенклатура":

Выделите поле Номенклатура. В палитре свойств на вкладке "События" найдите событие ПриИзменении и задайте процедуру-обработчик НоменклатураПриИзменении.

Важно: В XML для этого поля есть параметры выбора. Чтобы их воссоздать, нужно нажать на кнопку "..." у поля Связи параметров выбора и в таблице добавить отбор, чтобы выбиралась только готовая продукция (Тип = Готовая_продукция).

Создание страниц (закладок):

Добавьте элемент формы Страницы, назовите его Группа1.

Внутри него создайте две Группа - Страница:

Первая: СебестоимостьТЧ с заголовком "Себестоимость ТЧ".

Вторая: ТрудыТЧ с заголовком "Труды ТЧ".

Добавление таблицы "Себестоимость":

Найдите в папке Объект реквизит табличной части Себестоимость.

Перетащите его внутрь страницы СебестоимостьТЧ. Автоматически создастся таблица с колонками.

Настройка колонок таблицы "Себестоимость":

В таблице должны быть колонки: Материал, Количество, Цена, Сумма.

Отбор в колонке "Материал": Выделите колонку Материал. В поле Связи параметров выбора настройте отбор, чтобы выбирались только "Сырье" или "Полуфабрикаты".

События колонок:

У колонки Количество в событии ПриИзменении задайте СебестоимостьКоличествоПриИзменении.

У колонки Цена в событии ПриИзменении задайте СебестоимостьЦенаПриИзменении.

Редактирование колонки "Сумма":

Выделите колонку Сумма. В палитре свойств установите флажок ТолькоПросмотр (ReadOnly), так как сумма должна рассчитываться автоматически.

Добавление таблицы "Труды":

Найдите в папке Объект реквизит табличной части Труды.

Перетащите его внутрь страницы ТрудыТЧ. Автоматически создастся таблица с колонками ВидРаботы и Трудозатраты.














1. Создание документа "Реализация"
Где создать: Документы -> Добавить

Имя: Реализация

Синоним: Реализация

На вкладке "Данные":

Нумерация:

Тип номера: Строка

Длина номера: 9

Периодичность: Непериодический

Автонумерация: Да

Контроль уникальности: Да

Реквизиты (шапка документа):

Добавить -> Склад

Тип: СправочникСсылка.СкладГотовойПродукции

Синоним: Склад

Добавить -> Покупатель

Тип: СправочникСсылка.Покупатель

Синоним: Покупатель

Табличная часть:

Добавить -> Реализация (ТЧ называется так же, как и документ)

Синоним: Реализация

Реквизиты ТЧ:

Добавить -> Артикул

Тип: Строка (длина: 10)

Добавить -> ГотоваяПродукция

Тип: СправочникСсылка.Номенклатура

Синоним: Наименование

Важно: В XML для этого поля есть параметры выбора ChoiceParameters. Чтобы их воссоздать, нужно нажать на кнопку "..." у поля Связи параметров выбора и в таблице добавить отбор, чтобы выбиралась только номенклатура с типом "Готовая_продукция".

Добавить -> Количество

Тип: Число (длина: 10, точность: 0)

Добавить -> Цена

Тип: Число (длина: 10, точность: 2)

Добавить -> Сумма

Тип: Число (длина: 10, точность: 2)

На вкладке "Движения":

Нажмите кнопку Регистры -> Регистры накопления.

В открывшемся списке отметьте галкой регистр: СкладГотовойПродукции.

На вкладке "Прочее":

Проведение: Разрешить

Оперативное проведение: Разрешить

Удаление движений: Автоматически удалять при отмене проведения

Режим блокировки данных: Управляемый

2. Создание формы документа (ФормаДокумента)
Теперь создадим форму для документа, как в присланных файлах Form.xml (описание формы) и ФормаДокумента.xml (метаданные формы).

В окне редактирования документа Реализация перейдите на вкладку Формы.

Нажмите лупу у поля Форма документа -> Добавить.

Тип формы: Оставьте Форма документа.

Имя: Задайте ФормаДокумента.

Синоним: Форма документа.

Нажмите Готово.

Редактирование формы:

Реквизиты формы (вкладка "Реквизиты"):

Убедитесь, что главный реквизит Объект существует и имеет тип ДокументОбъект.Реализация.

Элементы формы (вкладка "Элементы"):

Перетащите поля Номер, Дата, Склад и Покупатель из панели "Реквизиты" на форму.

Добавление таблицы "Реализация":

Найдите в папке Объект реквизит табличной части Реализация.

Перетащите его на форму. Автоматически создастся элемент Таблица с колонками.

Настройка таблицы и колонок:

В свойствах таблицы (элемент Реализация) на вкладке "Общие" установите флажок Подвал (Footer).

В таблице должны быть колонки: Артикул, ГотоваяПродукция, Количество, Цена, Сумма.

Колонка "Артикул": Выделите колонку Артикул. В палитре свойств установите флажок ТолькоПросмотр (ReadOnly), так как он будет подставляться автоматически.

События колонок:

У колонки ГотоваяПродукция в событии ПриИзменении задайте РеализацияГотоваяПродукцияПриИзменении.

У колонки Количество в событии ПриИзменении задайте РеализацияКоличествоПриИзменении.

У колонки Цена в событии ПриИзменении задайте РеализацияЦенаПриИзменении.

Колонка "Сумма": Выделите колонку Сумма. Установите флажок ТолькоПросмотр. В поле ПутьКДаннымПодвала выберите Объект.Реализация.TotalСумма для отображения итога.

3. Создание формы списка (ФормаСписка)
Форма списка (Form.xml и ФормаСписка.xml) содержит командную панель с кнопкой и динамический список.

В окне редактирования документа Реализация на вкладке Формы нажмите лупу у поля Форма списка -> Добавить.

Тип формы: Выберите Форма списка.

Имя: Задайте ФормаСписка.

Синоним: Форма списка.

Нажмите Готово.

Редактирование формы списка:

Команды формы (вкладка "Команды"):

Добавьте команду (зеленый плюс -> "Создать команду"):

СформироватьZIPАрхив -> Синоним: Сформировать ZIP-архив

Реквизиты формы (вкладка "Реквизиты"):

Будет автоматически создан главный реквизит Список типа ДинамическийСписок. В его свойствах нужно настроить основную таблицу:

Найдите реквизит Список, откройте его свойства.

В поле Произвольный запрос должно быть Ложь.

В поле Основная таблица выберите Документ.Реализация.

Элементы формы (вкладка "Элементы"):

Командная панель: По умолчанию уже есть командная панель (ФормаКоманднаяПанель). Добавьте на нее кнопку. Перетащите команду СформироватьZIPАрхив из папки "Команды" внутрь ФормаКоманднаяПанель.

Таблица "Список": На форме уже есть элемент Список (таблица). В его свойствах можно настроить:

Режим обновления: Авто

Чередовать цвета строк: Да

Колонки таблицы: Раскройте элемент Список. Убедитесь, что есть колонки: Дата, Номер, Склад, Покупатель. Если их нет, перетащите соответствующие поля из реквизита Список.

4. Создание макета печати (Печать)
В файлах Template.xml и Печать.xml содержится макет табличного документа для печатной формы "Расходная накладная".

В окне редактирования документа Реализация перейдите на вкладку Макеты.

Нажмите зеленый плюс -> Добавить.

Имя: Печать (как в файле).

Тип макета: Оставьте Табличный документ.

Нажмите Готово.

Теперь нужно воссоздать макет. К сожалению, XML-формат макета слишком сложен для текстового описания всех ячеек и стилей. Я опишу его структуру, чтобы вы могли создать его вручную или вставить скопированный ранее макет, если он у вас есть:

Структура макета "Печать":

Верхний колонтитул (строки 0-2): Содержит рисунок (логотип). Можно вставить любую картинку.

Заголовок (строка 3): Крупный текст "Расходная Накладная", объединенный ячейки.

Шапка документа (строки 6-9):

Строка 6: "Номер" и параметр Номер.

Строка 7: "Дата" и параметр Дата.

Строка 8: "Склад" и параметр Склад.

Строка 9: "Покупатель" и параметр Покупатель.

Заголовок таблицы (строка 13): Колонки: №, Артикул, Наименование, Количество, Цена, Сумма.

Область строк таблицы (строка 14): Строка с параметрами для вывода данных табличной части:

Параметры: НомерСтроки, Артикул, ГотоваяПродукция, Количество, Цена, Сумма.

Именованные области (важно для печати):

Заголовок — строка 3.

Картинка — строки 0-1 (область с рисунком).

Реализация — строка 14 (область строк таблицы).

РеализацияШапка — строки 12-13 (область над таблицей).

Шапка — строки 5-9 (вся шапка документа).

5. Создание команды печати
В документе есть подчиненный объект — команда Печать.

В окне редактирования документа Реализация перейдите на вкладку Команды.

Нажмите зеленый плюс -> Добавить.

Имя: Печать.

Синоним: можно оставить пустым (будет как у имени).

Комментарий: можно оставить пустым.

Группа: Командная панель формы.Важное (это аналог FormCommandBarImportant).

Тип параметра команды: ДокументСсылка.Реализация.

Режим использования параметра: Несколько.

Модифицирует данные: Нет.

Представление: Авто.

Теперь нужно будет написать обработчик этой команды в модуле менеджера документа или в модуле формы списка, который будет выводить на печать макет Печать.




















1. Регистр накопления "СкладМатериалов"
Этот регистр будет хранить остатки материалов (сырья и полуфабрикатов) в разрезе складов и номенклатуры.

Где создать: Регистры накопления -> Добавить

Имя: СкладМатериалов

Синоним: Склад материалов

Вид регистра: Остатков (так как RegisterType в XML — Balance)

На вкладке "Данные":

Измерения:

Добавить -> Номенклатура

Тип данных: СправочникСсылка.Номенклатура

Синоним: Номенклатура

Запрет незаполненных значений: Ложь (как в XML)

Использовать в итогах: Использовать

Добавить -> Склад

Тип данных: СправочникСсылка.СкладМатериалов

Синоним: Склад

Запрет незаполненных значений: Ложь

Использовать в итогах: Использовать

Ресурсы:

Добавить -> Количество

Тип данных: Число (длина: 10, точность: 0)

Синоним: Количество

Реквизиты: Отсутствуют.

2. Регистр накопления "СкладГотовойПродукции"
Этот регистр будет хранить остатки готовой продукции в разрезе складов и номенклатуры.

Где создать: Регистры накопления -> Добавить

Имя: СкладГотовойПродукции

Синоним: Склад готовой продукции

Вид регистра: Остатков

На вкладке "Данные":

Измерения:

Добавить -> Номенклатура

Тип данных: СправочникСсылка.Номенклатура

Синоним: Номенклатура

Использовать в итогах: Использовать

Добавить -> Склад

Тип данных: СправочникСсылка.СкладГотовойПродукции

Синоним: Склад

Использовать в итогах: Использовать

Ресурсы:

Добавить -> Количество

Тип данных: Число (10, 0)

Синоним: Количество

Реквизиты: Отсутствуют.

3. Регистр накопления "ВыпускГотовойПродукции"
Судя по структуре (одно измерение и ресурс), этот регистр, вероятно, служит для накопления информации об объеме выпущенной продукции (возможно, для анализа или как промежуточный итог).

Где создать: Регистры накопления -> Добавить

Имя: ВыпускГотовойПродукции

Синоним: Выпуск готовой продукции

Вид регистра: Остатков

На вкладке "Данные":

Измерения:

Добавить -> Номенклатура

Тип данных: СправочникСсылка.Номенклатура

Синоним: Номенклатура

Использовать в итогах: Использовать

Ресурсы:

Добавить -> Количество

Тип данных: Число (10, 0)

Синоним: Количество

Реквизиты: Отсутствуют.

4. Регистр накопления "РасчетСебестоимости"
Этот регистр самый сложный. Он будет накапливать информацию о затратах (материальных и трудовых) для расчета себестоимости.

Где создать: Регистры накопления -> Добавить

Имя: РасчетСебестоимости

Синоним: Расчет себестоимости

Вид регистра: Остатков

На вкладке "Данные":

Измерения:

Добавить -> Номенклатура (видимо, это конечный продукт)

Тип данных: СправочникСсылка.Номенклатура

Синоним: Номенклатура

Использовать в итогах: Использовать

Добавить -> Материалы (конкретный материал, который был потрачен)

Тип данных: СправочникСсылка.Номенклатура

Синоним: Материалы

Использовать в итогах: Использовать

Добавить -> Трудозатраты (вид работ)

Тип данных: СправочникСсылка.СтоимостьЧаса

Синоним: Трудозатраты

Использовать в итогах: Использовать

Ресурсы:

Добавить -> Сумма (сумма материальных затрат)

Тип данных: Число (10, 2)

Синоним: Сумма

Добавить -> ТрудозатратыСумма (сумма трудовых затрат)

Тип данных: Число (10, 2)

Синоним: Трудозатраты сумма

Реквизиты: Отсутствуют.









1. Создание отчета "Excel"
Где создать: Отчеты -> Добавить

Имя: Excel (как в файле)

Синоним: Excel

На вкладке "Основные":

Расширенное представление: можно оставить пустым.

Пояснение: можно оставить пустым.

2. Создание макета СКД (ОсновнаяСхемаКомпоновкиДанных)
Это самый важный этап. Мы создадим макет и откроем конструктор схемы компоновки данных, чтобы настроить ее как в присланном файле.

В окне редактирования отчета Excel перейдите на вкладку Макеты.

Нажмите зеленый плюс -> Добавить.

Имя макета: ОсновнаяСхемаКомпоновкиДанных.

Тип макета: Выберите Схема компоновки данных.

Нажмите Готово.

Откроется конструктор схемы компоновки данных. Теперь нужно настроить его в точности как в XML-файле.

Настройка СКД:
2.1. Наборы данных (вкладка "Наборы данных"):

Нажмите кнопку "Добавить набор данных" (зеленый плюс) -> Добавить набор данных - запрос.

Имя: НаборДанных1 (как в XML).

Источник: ИсточникДанных1 (этот источник данных будет создан автоматически).

В поле Запрос вставьте следующий текст (из XML-файла):

sql
ВЫБРАТЬ
    СкладМатериаловОстатки.Номенклатура.Наименование КАК НаименованиеТовара,
    СкладМатериаловОстатки.Номенклатура.Код КАК Артикул,
    СкладМатериаловОстатки.Склад КАК Склад,
    СкладМатериаловОстатки.КоличествоОстаток КАК Остаток,
    МАКСИМУМ(ЗакупкаТЧ.Цена) КАК Цена
ИЗ
    РегистрНакопления.СкладМатериалов.Остатки(&ДатаОстатков) КАК СкладМатериаловОстатки
    ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.Закупка.Закупка КАК ЗакупкаТЧ
    ПО СкладМатериаловОстатки.Номенклатура = ЗакупкаТЧ.Материал
    ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.Закупка КАК ЗакупкаДок
    ПО ЗакупкаТЧ.Ссылка = ЗакупкаДок.Ссылка
        И СкладМатериаловОстатки.Склад = ЗакупкаДок.Склад
ГДЕ
    (СкладМатериаловОстатки.Номенклатура.Тип = ЗНАЧЕНИЕ(Перечисление.Тип.Сырье) 
     ИЛИ СкладМатериаловОстатки.Номенклатура.Тип = ЗНАЧЕНИЕ(Перечисление.Тип.Полуфабрикат))
    И НЕ СкладМатериаловОстатки.Номенклатура.ПометкаУдаления
    И СкладМатериаловОстатки.КоличествоОстаток > 0

СГРУППИРОВАТЬ ПО
    СкладМатериаловОстатки.Номенклатура.Наименование,
    СкладМатериаловОстатки.Номенклатура.Код,
    СкладМатериаловОстатки.Склад,
    СкладМатериаловОстатки.КоличествоОстаток

УПОРЯДОЧИТЬ ПО
    СкладМатериаловОстатки.Склад,
    СкладМатериаловОстатки.Номенклатура.Наименование
После вставки нажмите "ОК". Конструктор автоматически разберет поля запроса.

В таблице полей внизу настройте поля:

Для поля Склад в колонке "Роль" выберите Измерение.

Для полей Артикул, НаименованиеТовара, Остаток, Цена можно настроить синонимы (двойным кликом по колонке "Синоним"):

Артикул -> "Артикул"

НаименованиеТовара -> "Наименование товара"

Остаток -> "Остаток"

Цена -> "Цена"

2.2. Параметры (вкладка "Параметры"):

В списке параметров должны быть два параметра, которые были автоматически созданы из текста запроса:

ДатаОстатков (Тип: Дата). Установите флажок Ограничение использования = Авто.

Период (Тип: Дата). Установите флажок Ограничение использования = Авто.

2.3. Настройки (вкладка "Настройки"):
Здесь нужно создать структуру отчета, как в XML.

В левом верхнем углу, в поле "Вид структуры отчета", должно быть выбрано "Расширенный".

В дереве настроек (слева) уже есть корневой элемент. Выделите его.

В правой части, на вкладке Выбранные поля, нажмите кнопку "Добавить" (зеленый плюс) и выберите поля: НаименованиеТовара, Артикул, Цена, Остаток.

Перейдите на вкладку Структура.

Выделите корневой элемент (он называется "Детальные записи").

В командной панели структуры нажмите кнопку "Добавить группировку".

В открывшемся окне выберите поле НаименованиеТовара. Нажмите ОК.

Снова выделите корневой элемент, нажмите "Добавить группировку" и выберите поле Артикул. (У вас получится две группировки верхнего уровня).

Теперь выделите группировку НаименованиеТовара в дереве структуры.

Нажмите "Добавить группировку" и выберите поле Склад. (Это будет вложенная группировка).

Выделите группировку Склад.

В правой части, на вкладке Выбранные поля, нажмите "Добавить" и выберите поля Цена и Остаток. (Это те поля, которые будут выводиться на уровне склада).

Для полей Цена и Остаток также можно настроить авто-позицию в колонке "Положение".

В итоге структура должна выглядеть так:

text
Детальные записи
├── НаименованиеТовара
│   └── Склад
│       └── (поля: Цена, Остаток)
└── Артикул
    └── (здесь по умолчанию будут поля, выбранные в корне)
Важно: В XML также есть настройка параметра ДатаОстатков. Она будет доступна пользователю для ввода.

2.4. Связь с отчетом:

Закройте конструктор СКД.

Вернитесь в окно редактирования отчета Excel. На вкладке "Основные" в поле Основная схема компоновки данных выберите созданный макет ОсновнаяСхемаКомпоновкиДанных.

3. Создание формы отчета (ФормаОтчета)
Теперь создадим форму для отчета, как в присланных файлах Form.xml (описание формы) и ФормаОтчета.xml (метаданные формы).

В окне редактирования отчета Excel перейдите на вкладку Формы.

Нажмите лупу у поля Основная форма отчета -> Добавить.

Тип формы: Оставьте Форма отчета.

Имя: Задайте ФормаОтчета (как в файле).

Синоним: Форма отчета.

Нажмите Готово.

Редактирование формы:

Реквизиты формы (вкладка "Реквизиты"):

Главный реквизит Отчет уже есть.

Добавьте еще два реквизита:

Добавить -> Результат (имя как в XML)

Тип: Поле табличного документа (в списке типов найдите "Поле табличного документа")

Синоним: Результат

Добавить -> ДанныеРасшифровки

Тип: Строка (произвольной длины)

Синоним: оставьте пустым (в XML синонима нет)

Команды формы (вкладка "Команды"):

Здесь ничего добавлять не нужно. Кнопка "ЭкспортExcel" использует стандартную команду сохранения.

Элементы формы (вкладка "Элементы"):

Командная панель:

Найдите в списке элементов ФормаКоманднаяПанель.

Добавьте на нее кнопку. Для этого можно перетащить стандартную команду Save из папки "Команды" внутрь панели.

Выделите созданную кнопку, в свойствах задайте ей Имя = ЭкспортExcel, а Заголовок = Экспорт Excel.

Настройки отчета:

Добавьте элемент Группа - Обычная группа, назовите ее КомпоновщикНастроекПользовательскиеНастройки.

В свойствах группы установите Отображение = Нет.

Это контейнер для автоматического размещения настроек СКД.

Поле результата:

Добавьте элемент Поле табличного документа, назовите его Результат.

В поле ПутьКДанным выберите наш реквизит Результат.

В свойствах поля, на вкладке "Основные", установите Растягивать по вертикали = Да.

Заголовок = Нет.
















1. Создание отчета "ОтчетГотовойПродукции"
Где создать: Отчеты -> Добавить

Имя: ОтчетГотовойПродукции

Синоним: Отчет готовой продукции

На вкладке "Основные":

Остальные поля можно оставить пустыми.

2. Создание макета СКД (ОсновнаяСхемаКомпоновкиДанных)
В окне редактирования отчета ОтчетГотовойПродукции перейдите на вкладку Макеты.

Нажмите зеленый плюс -> Добавить.

Имя макета: ОсновнаяСхемаКомпоновкиДанных.

Тип макета: Выберите Схема компоновки данных.

Нажмите Готово.

Настройка СКД:
2.1. Наборы данных (вкладка "Наборы данных"):

Нажмите "Добавить набор данных" -> Добавить набор данных - запрос.

Имя: НаборДанных1.

Источник: ИсточникДанных1.

В поле Запрос вставьте следующий текст:

sql
ВЫБРАТЬ
    СкладГотовойПродукцииОстатки.Номенклатура КАК Номенклатура,
    СкладГотовойПродукцииОстатки.Склад КАК Склад,
    СкладГотовойПродукцииОстатки.КоличествоОстаток КАК КоличествоОстаток
ИЗ
    РегистрНакопления.СкладГотовойПродукции.Остатки КАК СкладГотовойПродукцииОстатки
После вставки нажмите "ОК".

В таблице полей внизу настройте роли:

Для поля Номенклатура в колонке "Роль" выберите Измерение.

Для поля Склад в колонке "Роль" выберите Измерение.

Поле КоличествоОстаток оставьте без роли (это ресурс).

2.2. Параметры (вкладка "Параметры"):

В списке параметров должен быть параметр Период. Установите для него флажок Ограничение использования = Авто.

2.3. Ресурсы (вкладка "Ресурсы"):

Нажмите "Добавить все" (или перетащите поле КоличествоОстаток в список ресурсов).

В колонке "Выражение" для ресурса КоличествоОстаток должно стоять "Сумма" (это значение по умолчанию).

2.4. Настройки (вкладка "Настройки"):

В левом верхнем углу выберите вид структуры "Расширенный".

Выделите корневой элемент "Детальные записи".

В правой части, на вкладке Выбранные поля, нажмите "Добавить" и выберите все поля: Склад, Номенклатура, КоличествоОстаток.

Перейдите на вкладку Структура.

Выделите корневой элемент.

Нажмите кнопку "Добавить группировку".

В открывшемся окне выберите поле Склад. Нажмите ОК.

В дереве структуры выделите созданную группировку Склад.

В правой части, на вкладке Выбранные поля, оставьте поля как есть (они наследуются, либо можно явно не выбирать).

В итоге структура будет выглядеть так:

text
Детальные записи
└── Склад
    └── (поля: Номенклатура, КоличествоОстаток)
2.5. Связь с отчетом:

Закройте конструктор СКД.

В окне редактирования отчета ОтчетГотовойПродукции на вкладке "Основные" в поле Основная схема компоновки данных выберите созданный макет ОсновнаяСхемаКомпоновкиДанных.
















1. Создание отчета "ОтчетОстаткиМатериалов"
Где создать: Отчеты -> Добавить

Имя: ОтчетОстаткиМатериалов

Синоним: Отчет остатки материалов

На вкладке "Основные":

Остальные поля можно оставить пустыми.

2. Создание макета СКД (ОсновнаяСхемаКомпоновкиДанных)
В окне редактирования отчета ОтчетОстаткиМатериалов перейдите на вкладку Макеты.

Нажмите зеленый плюс -> Добавить.

Имя макета: ОсновнаяСхемаКомпоновкиДанных.

Тип макета: Выберите Схема компоновки данных.

Нажмите Готово.

Настройка СКД:
2.1. Наборы данных (вкладка "Наборы данных"):

Нажмите "Добавить набор данных" -> Добавить набор данных - запрос.

Имя: НаборДанных1.

Источник: ИсточникДанных1.

В поле Запрос вставьте следующий текст:

sql
ВЫБРАТЬ
    СкладМатериаловОстатки.Номенклатура КАК Номенклатура,
    СкладМатериаловОстатки.Склад КАК Склад,
    СкладМатериаловОстатки.КоличествоОстаток КАК КоличествоОстаток
ИЗ
    РегистрНакопления.СкладМатериалов.Остатки КАК СкладМатериаловОстатки
После вставки нажмите "ОК".

В таблице полей внизу настройте роли:

Для поля Номенклатура в колонке "Роль" выберите Измерение.

Для поля Склад в колонке "Роль" выберите Измерение.

Поле КоличествоОстаток оставьте без роли (это ресурс).

2.2. Параметры (вкладка "Параметры"):

В списке параметров должен быть параметр Период. Установите для него флажок Ограничение использования = Авто.

2.3. Ресурсы (вкладка "Ресурсы"):

Нажмите "Добавить все" (или перетащите поле КоличествоОстаток в список ресурсов).

В колонке "Выражение" для ресурса КоличествоОстаток должно стоять "Сумма" (значение по умолчанию).

2.4. Настройки (вкладка "Настройки"):

В левом верхнем углу выберите вид структуры "Расширенный".

Выделите корневой элемент "Детальные записи".

В правой части, на вкладке Выбранные поля, нажмите "Добавить" и выберите все поля: Номенклатура, Склад, КоличествоОстаток.

Перейдите на вкладку Структура.

Выделите корневой элемент.

Нажмите кнопку "Добавить группировку".

В открывшемся окне выберите поле Склад. Нажмите ОК.

В дереве структуры выделите созданную группировку Склад.

В правой части, на вкладке Выбранные поля, оставьте поля как есть (они наследуются).

В итоге структура будет выглядеть так:

text
Детальные записи
└── Склад
    └── (поля: Номенклатура, КоличествоОстаток)
2.5. Связь с отчетом:

Закройте конструктор СКД.

В окне редактирования отчета ОтчетОстаткиМатериалов на вкладке "Основные" в поле Основная схема компоновки данных выберите созданный макет ОсновнаяСхемаКомпоновкиДанных.

3. Создание формы отчета (ФормаОтчета)
Теперь создадим форму для отчета, как в присланных файлах.

В окне редактирования отчета ОтчетОстаткиМатериалов перейдите на вкладку Формы.

Нажмите лупу у поля Основная форма отчета -> Добавить.

Тип формы: Оставьте Форма отчета.

Имя: Задайте ФормаОтчета.

Синоним: Форма отчета.

Нажмите Готово.

Редактирование формы:

Реквизиты формы (вкладка "Реквизиты"):

Главный реквизит Отчет уже есть.

Добавьте еще два реквизита:

Добавить -> Результат

Тип: Поле табличного документа

Синоним: Результат

Добавить -> ДанныеРасшифровки

Тип: Строка (произвольной длины)

Команды формы (вкладка "Команды"):

Добавьте команду (зеленый плюс -> "Создать команду"):

ОстаткиСырья -> Синоним: Остатки сырья

Элементы формы (вкладка "Элементы"):

Командная панель:

Найдите ФормаКоманднаяПанель.

Перетащите команду ОстаткиСырья из папки "Команды" внутрь панели.

Группа настроек:

Добавьте элемент Группа - Обычная группа, назовите ее КомпоновщикНастроекПользовательскиеНастройки.

В свойствах группы установите Отображение = Нет.

Поле результата:

Добавьте элемент Поле табличного документа, назовите его Результат.

В поле ПутьКДанным выберите наш реквизит Результат.

В свойствах поля, на вкладке "Основные", установите Растягивать по вертикали = Да.

Заголовок = Нет.














1. Создание отчета "ОтчетПоВыпускуГотовойПродукции"
Где создать: Отчеты -> Добавить

Имя: ОтчетПоВыпускуГотовойПродукции

Синоним: Отчет по выпуску готовой продукции

На вкладке "Основные":

Остальные поля можно оставить пустыми.

2. Создание макета СКД (ОсновнаяСхемаКомпоновкиДанных)
В окне редактирования отчета перейдите на вкладку Макеты.

Нажмите зеленый плюс -> Добавить.

Имя макета: ОсновнаяСхемаКомпоновкиДанных.

Тип макета: Выберите Схема компоновки данных.

Нажмите Готово.

Настройка СКД:
2.1. Наборы данных (вкладка "Наборы данных"):

Нажмите "Добавить набор данных" -> Добавить набор данных - запрос.

Имя: НаборДанных1.

Источник: ИсточникДанных1.

В поле Запрос вставьте следующий текст:

sql
ВЫБРАТЬ
    ВыпускГотовойПродукцииОбороты.Номенклатура КАК Номенклатура,
    ВыпускГотовойПродукцииОбороты.Номенклатура.Код КАК НоменклатураКод,
    ВыпускГотовойПродукцииОбороты.КоличествоОборот КАК КоличествоОборот
ИЗ
    РегистрНакопления.ВыпускГотовойПродукции.Обороты КАК ВыпускГотовойПродукцииОбороты
Важное замечание: В исходном XML запрос выглядит немного странно (дважды упоминается регистр). Я привел его к корректному виду для получения оборотов. Если в оригинале была какая-то особая логика, вы всегда можете отредактировать запрос позже.

После вставки нажмите "ОК".

В таблице полей внизу настройте:

Для поля Номенклатура в колонке "Роль" выберите Измерение.

Для поля НоменклатураКод можно установить синоним "Артикул" (двойным кликом по колонке "Синоним").

Поле КоличествоОборот оставьте без роли (это ресурс).

2.2. Параметры (вкладка "Параметры"):

В списке параметров должны быть два параметра, которые были автоматически созданы из текста запроса (так как мы используем виртуальную таблицу "Обороты"):

НачалоПериода (Тип: Дата). Установите флажок Ограничение использования = Авто.

КонецПериода (Тип: Дата). Установите флажок Ограничение использования = Авто.

2.3. Ресурсы (вкладка "Ресурсы"):

Нажмите "Добавить все" (или перетащите поле КоличествоОборот в список ресурсов).

В колонке "Выражение" для ресурса КоличествоОборот должно стоять "Сумма" (значение по умолчанию).

2.4. Настройки (вкладка "Настройки"):

В левом верхнем углу выберите вид структуры "Расширенный".

Выделите корневой элемент "Детальные записи".

В правой части, на вкладке Выбранные поля, нажмите "Добавить" и выберите поля: НоменклатураКод, Номенклатура, КоличествоОборот.

Перейдите на вкладку Структура.

Выделите корневой элемент.

Нажмите кнопку "Добавить группировку".

В открывшемся окне выберите поле НоменклатураКод. Нажмите ОК.

Снова выделите корневой элемент, нажмите "Добавить группировку" и выберите поле Номенклатура. (У вас получится две группировки верхнего уровня).

В XML также есть вложенная пустая группировка, но для простого отчета достаточно и этого.

В итоге структура может выглядеть так:

text
Детальные записи
├── НоменклатураКод
│   └── (поля: Номенклатура, КоличествоОборот)
└── Номенклатура
    └── (поля: КоличествоОборот)
2.5. Связь с отчетом:

Закройте конструктор СКД.

В окне редактирования отчета на вкладке "Основные" в поле Основная схема компоновки данных выберите созданный макет ОсновнаяСхемаКомпоновкиДанных.















1. Создание отчета "ОтчетПоСкладам"
Где создать: Отчеты -> Добавить

Имя: ОтчетПоСкладам

Синоним: Отчет по складам

На вкладке "Основные":

Остальные поля можно оставить пустыми.

2. Создание макета СКД (ОсновнаяСхемаКомпоновкиДанных)
В окне редактирования отчета перейдите на вкладку Макеты.

Нажмите зеленый плюс -> Добавить.

Имя макета: ОсновнаяСхемаКомпоновкиДанных.

Тип макета: Выберите Схема компоновки данных.

Нажмите Готово.

Настройка СКД:
2.1. Наборы данных (вкладка "Наборы данных"):

Нажмите "Добавить набор данных" -> Добавить набор данных - запрос.

Имя: НаборДанных1.

Источник: ИсточникДанных1.

В поле Запрос вставьте следующий текст (из XML-файла):

sql
ВЫБРАТЬ
    СкладМатериаловОстаткиИОбороты.Склад КАК Склад,
    СкладМатериаловОстаткиИОбороты.Номенклатура КАК Номенклатура,
    СкладМатериаловОстаткиИОбороты.КоличествоНачальныйОстаток КАК КоличествоНачальныйОстаток,
    СкладМатериаловОстаткиИОбороты.КоличествоПриход КАК КоличествоПриход,
    СкладМатериаловОстаткиИОбороты.КоличествоРасход КАК КоличествоРасход,
    СкладМатериаловОстаткиИОбороты.КоличествоКонечныйОстаток КАК КоличествоКонечныйОстаток,
    СкладГотовойПродукцииОстаткиИОбороты.Склад КАК Склад1,
    СкладГотовойПродукцииОстаткиИОбороты.Номенклатура КАК Номенклатура1,
    СкладГотовойПродукцииОстаткиИОбороты.КоличествоНачальныйОстаток КАК КоличествоНачальныйОстаток1,
    СкладГотовойПродукцииОстаткиИОбороты.КоличествоПриход КАК КоличествоПриход1,
    СкладГотовойПродукцииОстаткиИОбороты.КоличествоРасход КАК КоличествоРасход1,
    СкладГотовойПродукцииОстаткиИОбороты.КоличествоКонечныйОстаток КАК КоличествоКонечныйОстаток1
ИЗ
    РегистрНакопления.СкладМатериалов.ОстаткиИОбороты КАК СкладМатериаловОстаткиИОбороты,
    РегистрНакопления.СкладГотовойПродукции.ОстаткиИОбороты КАК СкладГотовойПродукцииОстаткиИОбороты
Важное замечание: Этот запрос создаст декартово произведение двух таблиц. Для реального отчета, скорее всего, потребуется доработка (например, объединение через ПОЛНОЕ СОЕДИНЕНИЕ), но для начала оставим как есть.

После вставки нажмите "ОК".

В таблице полей внизу настройте синонимы и роли для лучшего понимания:

Для полей из первого регистра (материалы):

Склад: Роль = Измерение, Синоним = "Склад Материалов"

Номенклатура: Роль = Измерение, Синоним = "Материалы"

КоличествоНачальныйОстаток: Синоним оставить как есть, или "Нач. остаток (мат.)"

КоличествоПриход: Синоним "Приход (мат.)"

КоличествоРасход: Синоним "Расход (мат.)"

КоличествоКонечныйОстаток: Синоним "Кон. остаток (мат.)"

Для полей из второго регистра (готовая продукция):

Склад1: Роль = Измерение, Синоним = "Склад Готовой продукции"

Номенклатура1: Роль = Измерение, Синоним = "Готовая продукция"

КоличествоНачальныйОстаток1: Синоним "Нач. остаток (ГП)"

КоличествоПриход1: Синоним "Приход (ГП)"

КоличествоРасход1: Синоним "Расход (ГП)"

КоличествоКонечныйОстаток1: Синоним "Кон. остаток (ГП)"

2.2. Параметры (вкладка "Параметры"):

В списке параметров должны быть два параметра, которые будут автоматически созданы из-за использования виртуальной таблицы "ОстаткиИОбороты":

НачалоПериода (Тип: Дата). Установите флажок Ограничение использования = Авто.

КонецПериода (Тип: Дата). Установите флажок Ограничение использования = Авто.

2.3. Настройки (вкладка "Настройки"):

В левом верхнем углу выберите вид структуры "Расширенный".

Выделите корневой элемент "Детальные записи".

В правой части, на вкладке Выбранные поля, нажмите "Добавить" и выберите все поля, которые мы настроили.

Перейдите на вкладку Структура. В XML очень сложная иерархия. Для упрощения можно создать структуру, которая группирует данные отдельно по материалам и отдельно по готовой продукции. Например:

Выделите корневой элемент.

Нажмите "Добавить группировку" и выберите Склад Материалов. Внутри нее можно добавить группировку по Материалы, а на нижнем уровне вывести ресурсы.

Снова выделите корневой элемент, нажмите "Добавить группировку" и выберите Склад Готовой продукции. Внутри нее — группировку по Готовая продукция, и на нижнем уровне — ресурсы по ГП.

В каждой группировке на вкладке Выбранные поля нужно выбрать те поля, которые должны выводиться на этом уровне.

2.4. Связь с отчетом:

Закройте конструктор СКД.

В окне редактирования отчета на вкладке "Основные" в поле Основная схема компоновки данных выберите созданный макет ОсновнаяСхемаКомпоновкиДанных.









1. Создание отчета "ОтчетСебестоимостиВыпущенный"
Где создать: Отчеты -> Добавить

Имя: ОтчетСебестоимостиВыпущенный

Синоним: Отчет себестоимости выпущенный

На вкладке "Основные":

Остальные поля можно оставить пустыми.

2. Создание макета СКД (ОсновнаяСхемаКомпоновкиДанных)
В окне редактирования отчета перейдите на вкладку Макеты.

Нажмите зеленый плюс -> Добавить.

Имя макета: ОсновнаяСхемаКомпоновкиДанных.

Тип макета: Выберите Схема компоновки данных.

Нажмите Готово.

Настройка СКД:
2.1. Наборы данных (вкладка "Наборы данных"):

Нажмите "Добавить набор данных" -> Добавить набор данных - запрос.

Имя: НаборДанных1.

Источник: ИсточникДанных1.

В поле Запрос вставьте следующий текст:

sql
ВЫБРАТЬ
    РасчетСебестоимостиОбороты.Номенклатура КАК Номенклатура,
    РасчетСебестоимостиОбороты.Материалы КАК Материалы,
    РасчетСебестоимостиОбороты.Трудозатраты КАК Трудозатраты,
    - РасчетСебестоимостиОбороты.СуммаОборот КАК СуммаОборот,
    - РасчетСебестоимостиОбороты.ТрудозатратыСуммаОборот КАК ТрудозатратыСуммаОборот
ИЗ
    РегистрНакопления.РасчетСебестоимости.Обороты КАК РасчетСебестоимостиОбороты
Примечание: Знак "минус" перед ресурсами, вероятно, связан с особенностью учета в регистре (например, расход отражается с минусом). В отчете это даст положительные суммы.

После вставки нажмите "ОК".

В таблице полей внизу настройте роли и синонимы:

Номенклатура: Роль = Измерение, Синоним оставить "Номенклатура".

Материалы: Роль = Измерение, Синоним оставить "Материалы".

Трудозатраты: Роль = Измерение, Синоним оставить "Трудозатраты".

СуммаОборот: Синоним = "Стоимость Материалов".

ТрудозатратыСуммаОборот: Синоним = "Стоимость Работ".

2.2. Вычисляемые поля (вкладка "Вычисляемые поля"):

Добавьте три вычисляемых поля (зеленый плюс):

Имя: СуммаМат
Выражение: СуммаОборот
Заголовок: Сумма Материалов
Тип: Число (длина 10, точность 2)
Имя: СуммаТруд
Выражение: ТрудозатратыСуммаОборот
Заголовок: Сумма Работ
Тип: Число (длина 10, точность 2)
Имя: Сумма
Выражение: СуммаОборот + ТрудозатратыСуммаОборот
Заголовок: Сумма
Тип: Число (длина 10, точность 2)
2.3. Поля итога (вкладка "Поля итога"):

Добавьте три поля итога:

Нажмите "Добавить", выберите Сумма.

Нажмите "Добавить", выберите СуммаМат.

Нажмите "Добавить", выберите СуммаТруд.

Для всех полей должно стоять выражение Сумма(<ИмяПоля>).

2.4. Параметры (вкладка "Параметры"):

В списке параметров должны быть два параметра:

НачалоПериода (Тип: Дата). Установите флажок Ограничение использования = Авто.

КонецПериода (Тип: Дата). Установите флажок Ограничение использования = Авто.

2.5. Настройки (вкладка "Настройки"):

В левом верхнем углу выберите вид структуры "Расширенный".

Выделите корневой элемент "Детальные записи".

В правой части, на вкладке Выбранные поля, нажмите "Добавить" и выберите поля: Номенклатура, Материалы, СуммаОборот, СуммаМат, Трудозатраты, ТрудозатратыСуммаОборот, СуммаТруд, Сумма. (Можно выбрать все).

Перейдите на вкладку Структура.

Выделите корневой элемент.

Нажмите кнопку "Добавить группировку".

В открывшемся окне выберите поле Номенклатура. Нажмите ОК.

Выделите созданную группировку Номенклатура.

Нажмите кнопку "Добавить группировку" и выберите поле Материалы. Нажмите ОК.

Выделите группировку Материалы.

В правой части, на вкладке Выбранные поля, оставьте поля, которые должны выводиться на этом уровне (например, СуммаМат, Сумма). Можно ничего не выбирать, если поля наследуются.

Аналогично можно создать вложенную группировку по Трудозатраты внутри группировки по Номенклатура (или отдельно).

2.6. Параметры вывода (вкладка "Параметры" в разделе настроек):

В XML есть настройки для расположения итогов. В конструкторе они находятся на вкладке "Параметры" (правая часть, когда выделен корневой элемент).

Найдите параметр Расположение итогов и установите значение В конце.

Найдите параметр Горизонтальное расположение общих итогов и установите Нет.

2.7. Связь с отчетом:

Закройте конструктор СКД.

В окне редактирования отчета на вкладке "Основные" в поле Основная схема компоновки данных выберите созданный макет ОсновнаяСхемаКомпоновкиДанных.
























1. Модуль "Клиентский"
Этот модуль будет выполняться на стороне клиента и помечен как глобальный (Глобальный = Истина). Это значит, что его функции и процедуры будут доступны из любого места на клиенте без явного обращения к модулю.

Где создать: Общие -> Общие модули -> Добавить

Имя: Клиентский

Синоним: Клиентский

На вкладке "Основные":

Глобальный: Флажок установлен (так как Global = true).

Клиент (управляемое приложение): Флажок установлен.

Сервер: Флажок снят.

Вызов сервера: Флажок снят (так как модуль не серверный).

Привилегированный: Флажок снят.

Повторное использование возвращаемых значений: Не использовать.

Остальные флажки (Назначение, Внешнее соединение, Клиент (обычное приложение)) должны быть сняты.

2. Модуль "Серверный"
Обычный серверный модуль. Его функции можно будет вызывать с клиента с помощью директивы &НаСервере.

Где создать: Общие -> Общие модули -> Добавить

Имя: Серверный

Синоним: Серверный

На вкладке "Основные":

Глобальный: Флажок снят.

Клиент (управляемое приложение): Флажок снят.

Сервер: Флажок установлен.

Вызов сервера: Флажок установлен (это позволяет вызывать экспортные процедуры этого модуля с клиента).

Привилегированный: Флажок снят.

Повторное использование возвращаемых значений: Не использовать.

3. Модуль "ОбщийСерверныйМодуль"
Еще один серверный модуль. Судя по названию, он предназначен для каких-то общих серверных алгоритмов.

Где создать: Общие -> Общие модули -> Добавить

Имя: ОбщийСерверныйМодуль

Синоним: Общий серверный модуль

На вкладке "Основные":

Настройки полностью идентичны модулю "Серверный":

Глобальный: Флажок снят.

Клиент (управляемое приложение): Флажок снят.

Сервер: Флажок установлен.

Вызов сервера: Флажок установлен.

Привилегированный: Флажок снят.

Повторное использование возвращаемых значений: Не использовать.

4. Модуль "ИИКлиентСервер"
Этот модуль, судя по флагам, может использоваться как на сервере, так и (предположительно, через вызов с сервера) содержать общую логику. Он не глобальный и не клиентский.

Где создать: Общие -> Общие модули -> Добавить

Имя: ИИКлиентСервер

Синоним: ИИКлиент сервер

На вкладке "Основные":

Глобальный: Флажок снят.

Клиент (управляемое приложение): Флажок снят.

Сервер: Флажок установлен.

Вызов сервера: Флажок установлен.

Привилегированный: Флажок снят.

Повторное использование возвращаемых значений: Не использовать.
















1. Создание обработчика "ГенераторДанныхИзделий"
Где создать: Обработки -> Добавить

Имя: ГенераторДанныхИзделий

Синоним: Генератор данных изделий

На вкладке "Данные":

Реквизиты:

Добавить -> КоличествоИзделий

Тип: Число (длина: 3, точность: 0)

Синоним: Количество изделий

Добавить -> ВидПроизводства

Тип: Строка (длина: 100)

Синоним: Вид производства

Добавить -> МинКоличествоМатериалов

Тип: Число (длина: 2, точность: 0)

Синоним: Мин количество материалов

Добавить -> МаксКоличествоМатериалов

Тип: Число (длина: 2, точность: 0)

Синоним: Макс количество материалов

Табличная часть:

Добавить -> ТЧПредпросмотр

Синоним: Предпросмотр

Реквизиты ТЧ:

Добавить -> Наименование

Тип: Строка (100)

Добавить -> Артикул

Тип: Строка (20)

Добавить -> ЕдиницаИзмерения

Тип: Строка (30)

Добавить -> ТипНоменклатуры

Тип: ПеречислениеСсылка.Тип

На вкладке "Прочее":

Все поля можно оставить по умолчанию.

2. Создание формы обработчика (Форма)
Теперь создадим форму для обработчика, как в присланных файлах Form.xml (описание формы) и Форма.xml (метаданные формы).

В окне редактирования обработчика ГенераторДанныхИзделий перейдите на вкладку Формы.

Нажмите лупу у поля Основная форма обработки -> Добавить.

Тип формы: Оставьте Форма обработки.

Имя: Задайте Форма.

Синоним: Форма.

Нажмите Готово.

Редактирование формы:

События формы (вкладка "Свойства" формы, "События"):

ПриОткрытии — укажите имя процедуры-обработчика ПриОткрытии (можно создать позже).

Реквизиты формы (вкладка "Реквизиты"):

Убедитесь, что главный реквизит Объект существует и имеет тип ОбработкаОбъект.ГенераторДанныхИзделий.

Команды формы (вкладка "Команды"):

Добавьте три команды (зеленый плюс -> "Создать команду"):

Сгенерировать -> Синоним: Сгенерировать

СохранитьВБазу -> Синоним: Сохранить в базу

СформироватьСпецификации -> Синоним: Сформировать спецификации

Элементы формы (вкладка "Элементы"):

Командная панель:

Найдите в списке элементов ФормаКоманднаяПанель.

Добавьте на нее группу кнопок: щелкните правой кнопкой мыши по панели -> "Добавить" -> "Группа кнопок". Назовите ее ФормаГруппа1.

В свойствах группы кнопок можно ничего не менять.

Перетащите команды Сгенерировать, СформироватьСпецификации и СохранитьВБазу из папки "Команды" внутрь созданной группы ФормаГруппа1.

Поля ввода:

Перетащите на форму реквизиты из папки Объект: КоличествоИзделий, ВидПроизводства, МинКоличествоМатериалов, МаксКоличествоМатериалов.

Выделите поле КоличествоИзделий. В его свойствах, на вкладке "Основные", в поле Заголовок введите "КоличествоИзделий (0-100)".

Табличная часть:

Найдите в папке Объект реквизит табличной части ТЧПредпросмотр.

Перетащите его на форму (например, под поля ввода). Автоматически создастся таблица.

В таблице будут колонки: Наименование, Артикул, ЕдиницаИзмерения, ТипНоменклатуры.

В свойствах колонки ТипНоменклатуры на вкладке "Основные" установите флажок Видимость = Ложь (снять галку), чтобы скрыть это поле, как в оригинале.























1. Создание обработчика "ГенераторЗаказовПроизводства"
Где создать: Обработки -> Добавить

Имя: ГенераторЗаказовПроизводства

Синоним: Генератор заказов производства

На вкладке "Данные":

Реквизиты:

Добавить -> ДатаНачала

Тип: Дата (состав даты: Дата)

Синоним: Дата начала

Добавить -> ДатаОкончания

Тип: Дата (состав даты: Дата)

Синоним: Дата окончания

Добавить -> КоличествоЗаказов

Тип: Число (длина: 3, точность: 0)

Синоним: Количество заказов

Добавить -> АвтоСозданиеЗакупки

Тип: Булево

Синоним: Авто создание закупки

Добавить -> АвтоСозданиеВыпуска

Тип: Булево

Синоним: Авто создание выпуска

Табличная часть:

Добавить -> ТЧРезультат

Синоним: Результат

Реквизиты ТЧ:

Добавить -> НомерЗаказа

Тип: Строка (20)

Добавить -> ДатаЗаказа

Тип: Дата (состав даты: Дата)

Добавить -> Изделие

Тип: Строка (100)

Добавить -> Количество

Тип: Число (10, 0)

Добавить -> Статус

Тип: Строка (20)

На вкладке "Прочее":

Все поля можно оставить по умолчанию.

2. Создание формы обработчика (Форма)
Теперь создадим форму для обработчика, как в присланных файлах.

В окне редактирования обработчика ГенераторЗаказовПроизводства перейдите на вкладку Формы.

Нажмите лупу у поля Основная форма обработки -> Добавить.

Тип формы: Оставьте Форма обработки.

Имя: Задайте Форма.

Синоним: Форма.

Нажмите Готово.

Редактирование формы:

События формы (вкладка "Свойства" формы, "События"):

ПриОткрытии — укажите имя процедуры-обработчика ПриОткрытии.

Реквизиты формы (вкладка "Реквизиты"):

Убедитесь, что главный реквизит Объект существует и имеет тип ОбработкаОбъект.ГенераторЗаказовПроизводства.

Команды формы (вкладка "Команды"):

Добавьте команду (зеленый плюс -> "Создать команду"):

СгенерироватьЗаказы -> Синоним: Сгенерировать заказы

Элементы формы (вкладка "Элементы"):

Командная панель:

Найдите в списке элементов ФормаКоманднаяПанель.

Перетащите команду СгенерироватьЗаказы из папки "Команды" внутрь панели.

Поля ввода:

Перетащите на форму реквизиты из папки Объект: ДатаНачала, ДатаОкончания, КоличествоЗаказов, АвтоСозданиеЗакупки, АвтоСозданиеВыпуска.

Для булевых полей (АвтоСозданиеЗакупки, АвтоСозданиеВыпуска) элемент создастся как ПолеФлажка — это правильно.

Табличная часть:

Найдите в папке Объект реквизит табличной части ТЧРезультат.

Перетащите его на форму (например, под поля ввода). Автоматически создастся таблица.

В таблице будут все колонки: НомерЗаказа, ДатаЗаказа, Изделие, Количество, Статус.






















1. Создание обработчика "ПомощникПрогнозаПотребностей"
Где создать: Обработки -> Добавить

Имя: ПомощникПрогнозаПотребностей

Синоним: Помощник прогноза потребностей

На вкладке "Данные":

Реквизиты:

Добавить -> ПериодПрогнозаМесяцев

Тип: Число (длина: 2, точность: 0)

Синоним: Период прогноза месяцев

Табличная часть:

Добавить -> ТЧРезультат

Синоним: Результат

Реквизиты ТЧ:

Добавить -> Материал

Тип: СправочникСсылка.Номенклатура

Добавить -> НаименованиеМатериала

Тип: Строка (100)

Добавить -> Месяц

Тип: Дата (состав даты: Дата)

Добавить -> Потребность

Тип: Число (длина: 15, точность: 0)

Добавить -> ПроцентУверенности

Тип: Число (длина: 5, точность: 2)

Добавить -> ТекущийОстаток

Тип: Число (длина: 15, точность: 0)

Знак числа: Произвольный (так как AllowedSign = Any)

Добавить -> ПрогнозОстатка

Тип: Число (длина: 15, точность: 0)

Знак числа: Произвольный

На вкладке "Прочее":

Все поля можно оставить по умолчанию.

2. Создание формы обработчика (Форма)
Теперь создадим форму для обработчика, как в присланных файлах. Это самая сложная форма среди всех обработчиков — она содержит закладки и диаграмму.

В окне редактирования обработчика ПомощникПрогнозаПотребностей перейдите на вкладку Формы.

Нажмите лупу у поля Основная форма обработки -> Добавить.

Тип формы: Оставьте Форма обработки.

Имя: Задайте Форма.

Синоним: Форма.

Нажмите Готово.

Редактирование формы:

События формы (вкладка "Свойства" формы, "События"):

ПриОткрытии — укажите имя процедуры-обработчика ПриОткрытии.

Реквизиты формы (вкладка "Реквизиты"):

Главный реквизит Объект уже есть.

Добавьте еще один реквизит:

Добавить -> ДиаграммаОстатков

Тип: Диаграмма (в списке типов найдите "Диаграмма")

Синоним: Диаграмма остатков

Команды формы (вкладка "Команды"):

Добавьте команду (зеленый плюс -> "Создать команду"):

ВыполнитьПрогноз -> Синоним: Выполнить прогноз

Элементы формы (вкладка "Элементы"):

Командная панель:

Найдите в списке элементов ФормаКоманднаяПанель.

Перетащите команду ВыполнитьПрогноз из папки "Команды" внутрь панели.

Создание страниц (закладок):

Добавьте элемент формы Страницы, назовите его Группа1.

Внутри него создайте две Группа - Страница:

Первая: Основное с заголовком "Основное".

Вторая: Диаграмма с заголовком "Диаграмма".

Наполнение страницы "Основное":

Перетащите на эту страницу реквизит ПериодПрогнозаМесяцев из папки Объект.

Найдите в папке Объект реквизит табличной части ТЧРезультат и перетащите его на страницу (под поле ввода). Автоматически создастся таблица.

В таблице будут колонки. Настройте их:

Колонка Материал — в ее свойствах установите флажок Видимость = Ложь (снять галку), чтобы скрыть, как в оригинале.

Остальные колонки (НаименованиеМатериала, Месяц, ТекущийОстаток, Потребность, ПроцентУверенности, ПрогнозОстатка) оставьте видимыми.

Для числовых колонок (ТекущийОстаток, Потребность, ПрогнозОстатка) в свойствах, на вкладке "Основные", в поле Формат можно задать "ЧН=" (как в XML), чтобы убрать разделители групп.

Для колонки ПроцентУверенности в поле Формат задайте "ЧДЦ=2; ЧФ=Ч%" (как в XML) для отображения в процентах.

Наполнение страницы "Диаграмма":

Добавьте на эту страницу элемент Поле диаграммы, назовите его ДиаграммаОстатков.

В поле ПутьКДанным выберите наш реквизит ДиаграммаОстатков.































1. Создание регистра сведений "НастройкиИИ"
Где создать: Регистры сведений -> Добавить

Имя: НастройкиИИ

Синоним: Настройки ИИ

На вкладке "Основные":

Режим записи: Независимый (так как WriteMode = Independent). Это означает, что записи в регистре существуют сами по себе и не привязаны к документу.

Периодичность: Непериодический (так как InformationRegisterPeriodicity = Nonperiodical).

Режим блокировки данных: Управляемый.

На вкладке "Данные":

Измерения:

У этого регистра нет измерений. Это означает, что в нем может быть только одна запись (или несколько, но без ключевых полей).

Ресурсы:

Добавить -> АдресСервера

Тип: Строка (длина: 255)

Синоним: Адрес сервера

Добавить -> Модель

Тип: Строка (длина: 100)

Синоним: Модель

Добавить -> Таймаут

Тип: Число (длина: 5, точность: 0)

Синоним: Таймаут

Реквизиты: Отсутствуют.

2. Создание формы списка (ФормаСписка)
Теперь создадим форму списка для регистра, как в присланных файлах.

В окне редактирования регистра НастройкиИИ перейдите на вкладку Формы.

Нажмите лупу у поля Форма списка -> Добавить.

Тип формы: Оставьте Форма списка.

Имя: Задайте ФормаСписка.

Синоним: Форма списка.

Нажмите Готово.

Редактирование формы списка:

События формы (вкладка "Свойства" формы, "События"):

ПриОткрытии — укажите имя процедуры-обработчика ПриОткрытии.

Реквизиты формы (вкладка "Реквизиты"):

Будет автоматически создан главный реквизит Список типа ДинамическийСписок. В его свойствах нужно настроить основную таблицу:

Найдите реквизит Список, откройте его свойства.

В поле Произвольный запрос должно быть Ложь.

В поле Основная таблица выберите РегистрСведений.НастройкиИИ.

Команды формы (вкладка "Команды"):

Добавьте две команды (зеленый плюс -> "Создать команду"):

ЗаписатьНастройки -> Синоним: Записать настройки

Обновить -> Синоним: Обновить

Элементы формы (вкладка "Элементы"):

Командная панель:

По умолчанию уже есть командная панель (ФормаКоманднаяПанель). Добавьте на нее кнопки. Перетащите команды ЗаписатьНастройки и Обновить из папки "Команды" внутрь ФормаКоманднаяПанель.

Группа настроек:

Добавьте элемент Группа - Обычная группа, назовите ее СписокКомпоновщикНастроекПользовательскиеНастройки.

В свойствах группы установите Отображение = Нет.

Таблица "Список":

На форме уже есть элемент Список (таблица). В его свойствах можно настроить:

Чередовать цвета строк: Да

Режим обновления: Авто

В поле Группа пользовательских настроек выберите нашу группу СписокКомпоновщикНастроекПользовательскиеНастройки.

Колонки таблицы: Раскройте элемент Список. Убедитесь, что есть колонки: АдресСервера, Модель, Таймаут. Если их нет, перетащите соответствующие поля из реквизита Список.

















1. Создание регистра сведений "Файлы"
Где создать: Регистры сведений -> Добавить

Имя: Файлы

Синоним: Файлы

На вкладке "Основные":

Режим записи: Независимый (WriteMode = Independent).

Периодичность: Непериодический.

Представление записи: Файл (в поле Представление записи).

Режим блокировки данных: Управляемый.

На вкладке "Данные":

Измерения:

Добавить -> Объект

Тип данных: Составной тип. Нажмите на кнопку "..." в поле "Тип" и отметьте галками все справочники и документы, к которым могут прикрепляться файлы. Можно также выбрать общий тип ЛюбаяСсылка (AnyRef), если он есть в списке.

Синоним: Объект

Ведущее: Флажок снят (Master = false).

Основной отбор: Флажок установлен (MainFilter = true).

Запрет незаполненных значений: Флажок установлен (DenyIncompleteValues = true).

Сокращение типов: Преобразовывать значения (оставить по умолчанию).

Ресурсы:

Добавить -> ДанныеФайла

Тип: Хранилище значения

Синоним: Данные файла

Реквизиты:

Добавить -> РазмерФайла

Тип: Число (длина: 10, точность: 0)

Синоним: Размер файла

Добавить -> РасширениеФайла

Тип: Строка (длина: 10)

Синоним: Расширение файла

2. Создание формы списка (ФормаСписка)
Теперь создадим форму списка для регистра, как в присланных файлах.

В окне редактирования регистра Файлы перейдите на вкладку Формы.

Нажмите лупу у поля Форма списка -> Добавить.

Тип формы: Оставьте Форма списка.

Имя: Задайте ФормаСписка.

Синоним: Форма списка.

Нажмите Готово.

Редактирование формы списка:

События формы (вкладка "Свойства" формы, "События"):

ПриОткрытии — укажите имя процедуры-обработчика ПриОткрытии.

Реквизиты формы (вкладка "Реквизиты"):

Будет автоматически создан главный реквизит Список типа ДинамическийСписок. В его свойствах нужно настроить основную таблицу:

Найдите реквизит Список, откройте его свойства.

В поле Произвольный запрос должно быть Ложь.

В поле Основная таблица выберите РегистрСведений.Файлы.

Команды формы (вкладка "Команды"):

Добавьте команду (зеленый плюс -> "Создать команду"):

Импорт -> Синоним: Импорт

Элементы формы (вкладка "Элементы"):

Командная панель:

Найдите в списке элементов ФормаКоманднаяПанель.

Перетащите команду Импорт из папки "Команды" внутрь панели.

Группа настроек:

Добавьте элемент Группа - Обычная группа, назовите ее СписокКомпоновщикНастроекПользовательскиеНастройки.

В свойствах группы установите Отображение = Нет.

Таблица "Список":

На форме уже есть элемент Список (таблица). В его свойствах можно настроить:

Чередовать цвета строк: Да

Режим обновления: Авто

В поле Группа пользовательских настроек выберите нашу группу СписокКомпоновщикНастроекПользовательскиеНастройки.

Колонки таблицы: Раскройте элемент Список. Убедитесь, что есть колонки: Объект, РазмерФайла, РасширениеФайла. Если их нет, перетащите соответствующие поля из реквизита Список.





















HTTP-сервис "ОбменДанными"
Где создать: HTTP-сервисы -> Добавить

Имя: ОбменДанными

Синоним: Обмен данными

На вкладке "Основные":

Корневой URL: services (это часть URL-адреса, например: http://server/base/hs/services/...)

Повторно использовать сеансы: Автоиспользовать (как в XML).

Время жизни сеанса (мин): 20 (как в XML).

Комментарий можно оставить пустым.

Создание шаблона URL "ОстаткиСырья"
Теперь нужно создать дочерний объект — шаблон URL.

В окне редактирования HTTP-сервиса ОбменДанными перейдите на вкладку Шаблоны URL.

Нажмите зеленый плюс -> Добавить.

Имя: ОстаткиСырья

Синоним: Остатки сырья

Шаблон: /sir (это добавится к корневому URL: .../hs/services/sir)

Создание метода "ОтправкаОстаток"
Теперь внутри шаблона URL нужно создать метод, который будет обрабатывать конкретный HTTP-запрос.

В окне редактирования шаблона URL ОстаткиСырья перейдите на вкладку Методы.

Нажмите зеленый плюс -> Добавить.

Имя: ОтправкаОстаток

Синоним: Отправка остаток

HTTP-метод: GET (как в XML).

Обработчик: В поле нужно указать имя экспортной процедуры в модуле HTTP-сервиса, которая будет вызвана при обращении к этому методу. Например, ОстаткиСырьяОтправкаОстаток (как в XML).

Модуль HTTP-сервиса
После создания всех объектов нужно написать код обработчика в модуле HTTP-сервиса.

Вернитесь к корню HTTP-сервиса ОбменДанными.

Перейдите на вкладку Прочее и нажмите кнопку Модуль.

В открывшемся модуле нужно будет создать экспортную процедуру с именем, указанным в методе (например, ОстаткиСырьяОтправкаОстаток), которая принимает стандартные параметры HTTP-сервиса.

bsl
// Пример структуры обработчика
Процедура ОстаткиСырьяОтправкаОстаток(Запрос, Ответ)

    // Здесь будет код для формирования ответа
    // Например, получение остатков из регистра "СкладМатериалов"
    // и возврат их в JSON или XML
    
    Ответ.УстановитьТипКонтента("application/json; charset=utf-8");
    Ответ.ТелоОтвета.Записать(ПолучитьJSONОстатков());

КонецПроцедуры
Готово! HTTP-сервис создан и готов к обработке GET-запросов на URL .../hs/services/sir.